#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import optparse
import fileinput
import sys
from cStringIO import StringIO


########################################################################### MAIN
################################################################################
def main():
    p = optparse.OptionParser()
    p.add_option('--format', '-f', action='store', dest='format', default=None, help='Input format (mandatory)'
    p.add_option('--input', '-i', action='store', dest='input', default=None, help='Raw input (ignores other input if supplied)'

    options, arguments = p.parse_args()

    if options.format is None:
        parser.error('Format not given')

    if options.input is not None:
        sys.stdout.write( abe-h.tangle( options.input, options.format) + '\n')
    else:
       ## Incorrect, just read whole file in var and use that.
       input_buffer = StringIO()
       for input_line in fileinput.input():
        input_buffer.write(input_line)

       sys.stdout.write( abe-h.tangle( input_buffer.get_value(), options.format) + '\n')

if __name__ == '__main__':
  main()
